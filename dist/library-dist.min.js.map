{"version":3,"sources":["library-dist.min.js","/source/library-dist.js"],"names":["_inherits","subClass","superClass","TypeError","prototype","Object","create","constructor","value","enumerable","writable","configurable","__proto__","_classCallCheck","instance","Constructor","_get","_x","_x2","_x3","_again","object","property","receiver","desc","parent","getter","undefined","Function","getOwnPropertyDescriptor","get","call","getPrototypeOf","_createClass","defineProperties","target","props","i","length","descriptor","defineProperty","key","protoProps","staticProps","global","factory","exports","module","require","define","amd","MyLibrary","Redispubsub","Ajax","i18n","this","AjaxTranslationsLoader","options","sucessCallback","failCallback","host","railsHost","port","railsPort","restPath","defaultPath","storage","load","request","then","data","console","log","ajaxTranslationsLoader","TranslationsLoader","locales","locale","translationsLoader","LocaleStorage","loader","defaultLoader","initialize","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","failCalllback","err","save","keys","JSON","stringify","window","localStorage","setItem","getItem","localeStorage","EventLogger","message","eventLogger","Internationalizer","init","internationalizer","StorageInternationalizer","_internationalizer","apply","arguments","resource","configurationFor","resStore","storageInternationalizer","Translator","parse","helpers_translator","TranslationSynchronizer","translator","translationSynchronizer","EventBus","channel","createChannel","realtimePort","realtimeHost","me","on","msg","sync","eventBus","TranslationManager","logger","index"],"mappings":"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","file":"library-dist.min.js","sourcesContent":[null,"(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('redis-pubsub'), require('ainojs-ajax'), require('i18n-node')) :\n  typeof define === 'function' && define.amd ? define(['redis-pubsub', 'ainojs-ajax', 'i18n-node'], factory) :\n  global.MyLibrary = factory(global.Redispubsub, global.Ajax, global.i18n)\n}(this, function (Redispubsub, Ajax, i18n) { 'use strict';\n\n  class AjaxTranslationsLoader {\n    constructor(options, sucessCallback, failCallback) {\n      this.host = options.railsHost || '127.0.0.1';\n      this.port = options.railsPort || 3000;\n      this.restPath = options.restPath || AjaxTranslationsLoader.defaultPath;\n      this.storage = options.storage;\n      this.sucessCallback = sucessCallback;\n      this.failCallback = failCallback;\n      this.load();\n    }\n\n    static get defaultPath() {\n      return '/translations';\n    }\n\n    get request() {\n      return `'http://${this.host}:${this.port}/translations?${this.restPath}'`; // use String interpolation!\n    }\n\n    load() {\n      Ajax.get(this.request).then(function(data) {\n        console.log(data);\n      }).catch(function(data) {\n        console.log(data);\n      });\n    }\n  }\n\n  var ajaxTranslationsLoader = AjaxTranslationsLoader;\n\n  class TranslationsLoader {\n    constructor(options) {\n      this.locales = options.locales;\n      this.options = options;\n    }\n\n    load(locale, sucessCallback, failCallback) {\n      this.options.restPath = `locale=${locale}`;\n      return new ajaxTranslationsLoader(this.options, sucessCallback, failCallback);\n    }\n  }\n\n  var translationsLoader = TranslationsLoader;\n\n  class LocaleStorage {\n    constructor(options) {\n      this.loader = options.loader || LocaleStorage.defaultLoader;\n      this.initialize();\n    }\n\n    static get defaultLoader() {\n      return new ajaxTranslationsLoader(\n        {},\n        this.sucessCallback,\n        this.failCalllback);\n    }\n\n    initialize() {\n      // retrieve via loader\n      for (let locale of this.loader.locales) {\n        this.loader.load(\n          locale,\n          this.sucessCallback,\n          this.failCalllback);\n      }\n    }\n\n    sucessCallback(data) {\n      // do stuff with data\n      console.log('save');\n      this.save(Object.keys(data)[0], JSON.stringify(data[Object.keys(data)[0]]));\n    }\n\n    failCalllback(data) {\n      // do stuff with data\n      console.log('fail');\n      console.log(data);\n    }\n\n    save(key, value) {\n      window.localStorage.setItem(key, value);\n      console.log('localStorage = ' + key + ' : ' + value);\n    }\n\n    load(key) {\n      window.localStorage.getItem(key);\n    }\n  }\n\n  var localeStorage = LocaleStorage;\n\n  /**\n   * @class\n   * An awesome script\n   */\n  class EventLogger {\n    log(message) {\n      console.log(message);\n    }\n  }\n\n  var eventLogger = EventLogger;\n\n  class Internationalizer {\n    // constructor(options) {\n    //   // ??\n    // }\n\n    init(options) {\n      i18n.init(options);\n    }\n  }\n\n  var internationalizer = Internationalizer;\n\n  class StorageInternationalizer extends internationalizer {\n    init(resource) {\n      super.init(this.configurationFor(resource));\n    }\n\n    configurationFor(resource) {\n      return {resStore: resource};\n    }\n\n  }\n\n  var storageInternationalizer = StorageInternationalizer;\n\n  /**\n   * @class\n   * An awesome script\n   */\n  class Translator {\n    contructor(message) {\n      this.key = Object.keys(message)[0];\n      this.value = JSON.stringify(message[this.key]);\n    }\n\n    get locale() {\n      return localStorage.getItem(this.key);\n    }\n\n    get translation() {\n      return JSON.parse(this.locale);\n    }\n\n    // get resource() {\n    //   return {key: {translation: value}};\n    // }\n  }\n\n  var helpers_translator = Translator;\n\n  class TranslationSynchronizer {\n    constructor(options) {\n      this.storage = options.storage;\n    }\n\n    sync(message) {\n      var translator = new helpers_translator(message);\n      (new storageInternationalizer()).init(translator.resource());\n      this.storage.save(Object.keys(message)[0], JSON.stringify(message[Object.keys(message)[0]]));\n    }\n  }\n\n  var translationSynchronizer = TranslationSynchronizer;\n\n  class EventBus {\n    constructor(options) {\n      this.eventLogger = new eventLogger(options);\n      this.translationSynchronizer = new translationSynchronizer(options);\n      this.channel = Redispubsub.createChannel(\n        options.realtimePort || 6379,\n        options.realtimeHost || '127.0.0.1',\n        options.channel || 'realtime_msg');\n      this.init();\n    }\n\n    init() {\n      var me = this;\n      this.channel.on('connect', function() {\n        me.channel.on('message', function(msg) {\n          me.eventLogger.log(msg.msg);\n          me.translationSynchronizer.sync(msg);\n        });\n      });\n    }\n  }\n\n  var eventBus = EventBus;\n\n  class TranslationManager {\n    constructor(options) {\n      this.options = options;\n      options.loader = new translationsLoader(options || {});\n      this.storage = new localeStorage(options);\n      this.logger = options.logger || console.log;\n      this.eventBus = new eventBus(options);\n    }\n  }\n\n  var index = TranslationManager;\n\n  return index;\n\n}));\n"],"sourceRoot":"/source/"}